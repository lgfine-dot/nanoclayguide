<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<script defer src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

{{/* --- Favicon --- */}}
<link rel="icon" href="/favicon.ico" sizes="48x48">
<link rel="icon" href="/favicon.svg" type="image/svg+xml">
<link rel="icon" href="/favicon-32x32.png" type="image/png" sizes="32x32">
<link rel="icon" href="/favicon-16x16.png" type="image/png" sizes="16x16">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">

{{/* --- Resolve SEO-overridable fields once --- */}}
{{ $seoTitle := .Params.seo_title | default .Title }}
{{ $desc := .Params.seo_description | default .Description | default .Site.Params.description }}
{{ if and (not .Params.seo_description) (not .Description) }}
  {{ with .Summary }}{{ $desc = . | plainify | truncate 160 }}{{ end }}
{{ end }}

{{ $img := "" }}
{{ with .Params.featured_image }}{{ $img = . | absURL }}{{ else }}{{ with .Params.image }}{{ $img = . | absURL }}{{ end }}{{ end }}

{{/* --- Title tag --- */}}
<title>{{ if .IsHome }}{{ .Site.Title }} â€” {{ .Site.Params.tagline }}{{ else }}{{ $seoTitle }} | {{ .Site.Title }}{{ end }}</title>

{{/* --- SEO Meta --- */}}
<meta name="description" content="{{ $desc }}">
<meta name="author" content="{{ .Site.Params.author | default .Site.Title }}">
{{ with .Params.keywords }}<meta name="keywords" content="{{ delimit . ", " }}">{{ end }}
<link rel="canonical" href="{{ .Permalink }}">
{{ with .Params.robots }}<meta name="robots" content="{{ . }}">{{ end }}

{{/* --- RSS Autodiscovery --- */}}
{{ with .OutputFormats.Get "RSS" }}
<link rel="alternate" type="{{ .MediaType }}" href="{{ .Permalink }}" title="{{ $.Site.Title }}">
{{ end }}

{{/* --- Open Graph --- */}}
<meta property="og:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ $seoTitle }}{{ end }}">
<meta property="og:description" content="{{ $desc }}">
<meta property="og:url" content="{{ .Permalink }}">
<meta property="og:site_name" content="{{ .Site.Title }}">
<meta property="og:locale" content="en_US">
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
{{ if $img }}<meta property="og:image" content="{{ $img }}">{{ end }}
{{ if .IsPage }}
<meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
{{ with .Lastmod }}<meta property="article:modified_time" content="{{ .Format "2006-01-02T15:04:05Z07:00" }}">{{ end }}
{{ range .Params.tags }}<meta property="article:tag" content="{{ . }}">{{ end }}
{{ end }}

{{/* --- Twitter Cards --- */}}
<meta name="twitter:card" content="{{ if $img }}summary_large_image{{ else }}summary{{ end }}">
<meta name="twitter:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ $seoTitle }}{{ end }}">
<meta name="twitter:description" content="{{ $desc }}">
{{ if $img }}<meta name="twitter:image" content="{{ $img }}">{{ end }}
{{ with .Site.Params.twitter }}<meta name="twitter:site" content="@{{ . }}">{{ end }}

{{/* --- Schema.org JSON-LD --- */}}
{{ if .IsHome }}
{{/* Homepage: WebSite with SearchAction */}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": {{ .Site.Title | jsonify }},
  "url": {{ .Site.BaseURL | jsonify }},
  "description": {{ .Site.Params.description | jsonify }},
  "publisher": {
    "@type": "Organization",
    "name": "AGCP Farmaceuticos, LDA",
    "url": "https://agcp.pt"
  },
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": {{ (printf "%ssearch?q={search_term_string}" .Site.BaseURL) | jsonify }}
    },
    "query-input": "required name=search_term_string"
  }
}
</script>

{{ else if and .IsPage (eq .Section "blog") }}
{{/* Blog posts: Article schema */}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": {{ $seoTitle | jsonify }},
  "url": {{ .Permalink | jsonify }},
  "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
  "dateModified": "{{ (.Lastmod | default .Date).Format "2006-01-02T15:04:05Z07:00" }}",
  "description": {{ $desc | jsonify }},
  {{ if $img }}"image": {{ $img | jsonify }},{{ end }}
  "wordCount": {{ .WordCount }},
  "author": {
    "@type": "Person",
    "name": {{ .Params.author | default .Site.Params.author | default .Site.Title | jsonify }}
  },
  "publisher": {
    "@type": "Organization",
    "name": "AGCP Farmaceuticos, LDA",
    "url": "https://agcp.pt",
    "logo": {
      "@type": "ImageObject",
      "url": {{ (printf "%sfavicon.svg" .Site.BaseURL) | jsonify }}
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": {{ .Permalink | jsonify }}
  }{{ with .Params.categories }},
  "articleSection": {{ index . 0 | jsonify }}{{ end }}{{ with .Params.tags }},
  "keywords": {{ . | jsonify }}{{ end }}
}
</script>

{{ else if and .IsSection (eq .Section "pillars") }}
{{/* Pillar section pages: CollectionPage schema */}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": {{ $seoTitle | jsonify }},
  "url": {{ .Permalink | jsonify }},
  "description": {{ $desc | jsonify }},
  "isPartOf": {
    "@type": "WebSite",
    "name": {{ .Site.Title | jsonify }},
    "url": {{ .Site.BaseURL | jsonify }}
  }
}
</script>

{{ else if .IsPage }}
{{/* Other pages: generic WebPage schema */}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": {{ $seoTitle | jsonify }},
  "url": {{ .Permalink | jsonify }},
  "description": {{ $desc | jsonify }},
  "isPartOf": {
    "@type": "WebSite",
    "name": {{ .Site.Title | jsonify }},
    "url": {{ .Site.BaseURL | jsonify }}
  }
}
</script>
{{ end }}

{{/* --- BreadcrumbList for non-home pages --- */}}
{{ if not .IsHome }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": {{ .Site.BaseURL | jsonify }}
    }{{ if .Parent }},
    {
      "@type": "ListItem",
      "position": 2,
      "name": {{ .Parent.Title | jsonify }},
      "item": {{ .Parent.Permalink | jsonify }}
    }{{ end }}{{ if and .Parent .IsPage }},
    {
      "@type": "ListItem",
      "position": 3,
      "name": {{ .Title | jsonify }},
      "item": {{ .Permalink | jsonify }}
    }{{ else if not .Parent }},
    {
      "@type": "ListItem",
      "position": 2,
      "name": {{ .Title | jsonify }},
      "item": {{ .Permalink | jsonify }}
    }{{ end }}
  ]
}
</script>
{{ end }}

{{/* --- Google Fonts --- */}}
<meta name="theme-color" content="#8B4513">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="dns-prefetch" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="dns-prefetch" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

{{/* --- Styles: inline critical CSS, async full CSS --- */}}
{{ $critical := resources.Get "css/critical.css" | resources.Minify }}
<style>{{ $critical.Content | safeCSS }}</style>
{{ $full := resources.Get "css/main.css" | resources.Minify | resources.Fingerprint }}
<link rel="preload" href="{{ $full.RelPermalink }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ $full.RelPermalink }}"></noscript>

{{/* --- LCP preload hint for blog post hero images --- */}}
{{ if and .IsPage (eq .Section "blog") }}
  {{ with .Params.featured_image }}
  <link rel="preload" href="{{ . | relURL }}" as="image" fetchpriority="high">
  {{ end }}
{{ end }}

{{/* --- Analytics --- */}}
{{ if eq .Site.Params.analyticsProvider "plausible" }}
  {{ with .Site.Params.plausibleDomain }}
  <script defer data-domain="{{ . }}" src="https://plausible.io/js/script.js"></script>
  {{ end }}
{{ else if eq .Site.Params.analyticsProvider "google" }}
  {{ with .Site.Params.googleAnalyticsID }}
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ . }}"></script>
  <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','{{ . }}');</script>
  {{ end }}
{{ end }}
